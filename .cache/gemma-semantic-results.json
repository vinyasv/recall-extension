🧪 Hybrid Search End-to-End Test

============================================================

📦 Initializing in-memory database with test corpus...
[EmbeddingService] Initializing EmbeddingGemma model: onnx-community/embeddinggemma-300m-ONNX
[EmbeddingService] Running in: Node.js
[EmbeddingService] Using device: cpu
[EmbeddingService] EmbeddingGemma model initialized successfully
[EmbeddingService] Model produces 768 dimensional embeddings
✅ Indexed 15 pages in memory

🔍 Running SEMANTIC evaluation...
  Query: "React hooks for state management"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=1 M=0 L=0
  Query: "useEffect side effects synchronization"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=1 M=0 L=0
  Query: "Python list methods append extend"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=1 M=0 L=0
  Query: "TypeScript generic type parameters"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=1 M=0 L=0
  Query: "React component state"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=2 M=0 L=0
  Query: "machine learning models"
    Precision: 0.0%
    Recall: 0.0%
    MRR: 0.000
    Results: 0
    Confidence: H=0 M=0 L=0
  Query: "git commit message"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=1 M=0 L=0
  Query: "promise then catch"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=1 M=0 L=0

🔍 Running KEYWORD evaluation...
  Query: "React hooks for state management"
    Precision: 10.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 10
    Confidence: H=0 M=10 L=0
  Query: "useEffect side effects synchronization"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=0 M=2 L=0
  Query: "Python list methods append extend"
    Precision: 16.7%
    Recall: 100.0%
    MRR: 1.000
    Results: 6
    Confidence: H=0 M=6 L=0
  Query: "TypeScript generic type parameters"
    Precision: 20.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 5
    Confidence: H=0 M=5 L=0
  Query: "React component state"
    Precision: 40.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 5
    Confidence: H=0 M=5 L=0
  Query: "machine learning models"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=0 M=1 L=0
  Query: "git commit message"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=0 M=2 L=0
  Query: "promise then catch"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=0 M=2 L=0

🔍 Running HYBRID evaluation (alpha=0.7)...
  Query: "React hooks for state management"
    Precision: 10.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 10
    Confidence: H=1 M=9 L=0
  Query: "useEffect side effects synchronization"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=1 M=1 L=0
  Query: "Python list methods append extend"
    Precision: 16.7%
    Recall: 100.0%
    MRR: 1.000
    Results: 6
    Confidence: H=1 M=5 L=0
  Query: "TypeScript generic type parameters"
    Precision: 20.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 5
    Confidence: H=1 M=4 L=0
  Query: "React component state"
    Precision: 40.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 5
    Confidence: H=2 M=3 L=0
  Query: "machine learning models"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=0 M=1 L=0
  Query: "git commit message"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=1 M=1 L=0
  Query: "promise then catch"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=1 M=1 L=0

🔍 Running HYBRID evaluation (alpha=0.5)...
  Query: "React hooks for state management"
    Precision: 10.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 10
    Confidence: H=1 M=9 L=0
  Query: "useEffect side effects synchronization"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=1 M=1 L=0
  Query: "Python list methods append extend"
    Precision: 16.7%
    Recall: 100.0%
    MRR: 1.000
    Results: 6
    Confidence: H=1 M=5 L=0
  Query: "TypeScript generic type parameters"
    Precision: 20.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 5
    Confidence: H=1 M=4 L=0
  Query: "React component state"
    Precision: 40.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 5
    Confidence: H=2 M=3 L=0
  Query: "machine learning models"
    Precision: 100.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 1
    Confidence: H=0 M=1 L=0
  Query: "git commit message"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=1 M=1 L=0
  Query: "promise then catch"
    Precision: 50.0%
    Recall: 100.0%
    MRR: 1.000
    Results: 2
    Confidence: H=1 M=1 L=0

============================================================
📊 OVERALL RESULTS

┌─────────────────┬──────────┬──────────┬──────────┬──────────┐
│ Mode            │ Prec     │ Recall   │ MRR      │ Results  │
├─────────────────┼──────────┼──────────┼──────────┼──────────┤
│ Semantic        │   87.5%  │   87.5%  │    0.875 │      1.0 │
│ Keyword         │   42.1%  │  100.0%  │    1.000 │      4.1 │
│ Hybrid (α=0.7)  │   42.1%  │  100.0%  │    1.000 │      4.1 │
│ Hybrid (α=0.5)  │   42.1%  │  100.0%  │    1.000 │      4.1 │
└─────────────────┴──────────┴──────────┴──────────┴──────────┘

📈 Confidence Distribution (avg per query):

┌─────────────────┬──────────┬──────────┬──────────┐
│ Mode            │ High     │ Medium   │ Low      │
├─────────────────┼──────────┼──────────┼──────────┤
│ Semantic        │      1.0 │      0.0 │      0.0 │
│ Keyword         │      0.0 │      4.1 │      0.0 │
│ Hybrid (α=0.7)  │      1.0 │      3.1 │      0.0 │
│ Hybrid (α=0.5)  │      1.0 │      3.1 │      0.0 │
└─────────────────┴──────────┴──────────┴──────────┘

🎯 ANALYSIS:

✅ Best Precision: Semantic (87.5%)
✅ Best Recall: Keyword (100.0%)
✅ Best MRR: Keyword (1.000)

💡 RECOMMENDATIONS:

⚠️  Semantic-only matches or exceeds hybrid precision.
   → Consider increasing alpha (e.g., 0.8-0.9) to trust semantic more.
⚠️  Few high-confidence results. Check if threshold (0.70) needs adjustment.

============================================================
✅ Test complete!

